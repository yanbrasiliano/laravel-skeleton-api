# Format PHP files using Pint
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep ".php\{0,1\}$") || true

for FILE in $STAGED_FILES; do
  docker exec -i skeleton-api ./vendor/bin/pint "${FILE}" >/dev/null >&1
  git add "${FILE}"
done

# Run phpstan inside Docker container
docker exec -i skeleton-api ./vendor/bin/phpstan analyse
if [ $? -ne 0 ]; then
  echo "Oops! PHPSTAN went wrong here. Fix it before continuing... ðŸ˜‰"
  exit 1
fi

# Run the tests inside Docker container
docker exec -i skeleton-api php artisan test --parallel | docker exec -i skeleton-api php
if [ $? -ne 0 ]; then
  echo "Oops! Some test went wrong here. Fix it before continuing... ðŸ˜‰"
  exit 1
fi

exit 0
